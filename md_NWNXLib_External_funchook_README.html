<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.17"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>NWNX:EE: Funchook - an API hook library</title>
                <link href="logo-transparent.png" rel="shortcut icon" type="image/x-icon">
                <link href="logo-transparent.png" rel="apple-touch-icon-precomposed">
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectlogo"><img width="80" height="74" alt="Logo" src="logo-transparent.png"/></td>
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">NWNX:EE
								&#160;<span id="projectnumber">8193.34</span>
							</div>
						</td>
						<td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_NWNXLib_External_funchook_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Funchook - an API hook library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md170"></a>
NOTE</h1>
<p>This is a minimal copy of the original <a href="https://github.com/kubo/funchook">funchook repo</a>, including only the files necessary for NWNX to work.</p>
<hr  />
<p>This library depends on <a href="https://github.com/gdabah/distorm/">diStorm3</a>.</p>
<p><a href="https://travis-ci.org/kubo/funchook"><object type="image/svg+xml" data="https://travis-ci.org/kubo/funchook.svg?branch=master" style="pointer-events: none;">Build Status</object></a> <a href="https://ci.appveyor.com/project/kubo/funchook/branch/master"><img src="https://ci.appveyor.com/api/projects/status/molkbu0csbshbnmh/branch/master?svg=true" alt="Build status" class="inline"/></a></p>
<h2><a class="anchor" id="autotoc_md172"></a>
TODO</h2>
<ul>
<li>write documents.</li>
</ul>
<h2><a class="anchor" id="autotoc_md173"></a>
Supported Platforms</h2>
<ul>
<li>Linux x86_64 (*1)</li>
<li>Linux x86 (*1)</li>
<li>OS X x86_64 (*1) (Xcode version &lt;= 10.3(*3))</li>
<li>OS X x86 (*1) (Xcode version &lt;= 10.1(*4))</li>
<li>Windows x64 (*2) (except C-runtime functions under <a href="https://www.winehq.org/">Wine</a>)</li>
<li>Windows 32-bit (*2)</li>
</ul>
<p>*1 tested on <a href="https://travis-ci.org/kubo/funchook">Travis CI</a> <br  />
 *2 tested on <a href="https://ci.appveyor.com/project/kubo/funchook/branch/master">AppVeyor</a> <br  />
 *3 Unit tests pass with xcode 10.3 on macOS 10.14.4 Mojave but fail with xcode 11.0 on the same macOS version. See <a href="https://travis-ci.org/kubo/funchook/builds/601220026">here</a>. <br  />
 *4 Xcode 10.2 dropped support for building 32-bit apps.</p>
<h2><a class="anchor" id="autotoc_md174"></a>
Compilation</h2>
<div class="fragment"><div class="line">$ git clone --recursive https://github.com/kubo/funchook.git</div>
<div class="line">$ cd funchook</div>
<div class="line">$ ./autogen.sh</div>
<div class="line">$ ./configure</div>
<div class="line">$ make</div>
<div class="line">$ make test</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md175"></a>
Example</h2>
<div class="fragment"><div class="line"><span class="keyword">static</span> ssize_t (*send_func)(<span class="keywordtype">int</span> sockfd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags);</div>
<div class="line"><span class="keyword">static</span> ssize_t (*recv_func)(<span class="keywordtype">int</span> sockfd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> ssize_t send_hook(<span class="keywordtype">int</span> sockfd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags);</div>
<div class="line">{</div>
<div class="line">    ssize_t rv;</div>
<div class="line"> </div>
<div class="line">    ... <span class="keywordflow">do</span> your task: logging, etc. ...</div>
<div class="line">    rv = send_func(sockfd, buf, len, flags); <span class="comment">/* call the original send(). */</span></div>
<div class="line">    ... <span class="keywordflow">do</span> your task: logging, checking the <span class="keywordflow">return</span> value, etc. ...</div>
<div class="line">    <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> ssize_t recv_hook(<span class="keywordtype">int</span> sockfd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags);</div>
<div class="line">{</div>
<div class="line">    ssize_t rv;</div>
<div class="line"> </div>
<div class="line">    ... <span class="keywordflow">do</span> your task: logging, etc. ...</div>
<div class="line">    rv = recv_func(sockfd, buf, len, flags); <span class="comment">/* call the original recv(). */</span></div>
<div class="line">    ... <span class="keywordflow">do</span> your task: logging, checking received data, etc. ...</div>
<div class="line">    <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> install_hooks()</div>
<div class="line">{</div>
<div class="line">    funchook_t *funchook = funchook_create();</div>
<div class="line">    <span class="keywordtype">int</span> rv;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Prepare hooking.</span></div>
<div class="line"><span class="comment">     * The return value is used to call the original send function</span></div>
<div class="line"><span class="comment">     * in send_hook.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    send_func = send;</div>
<div class="line">    rv = funchook_prepare(funchook, (<span class="keywordtype">void</span>**)&amp;send_func, send_hook);</div>
<div class="line">    <span class="keywordflow">if</span> (rv != 0) {</div>
<div class="line">       <span class="comment">/* error */</span></div>
<div class="line">       ...</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ditto */</span></div>
<div class="line">    recv_func = recv;</div>
<div class="line">    rv = funchook_prepare(funchook, (<span class="keywordtype">void</span>**)&amp;recv_func, recv_hook);</div>
<div class="line">    <span class="keywordflow">if</span> (rv != 0) {</div>
<div class="line">       <span class="comment">/* error */</span></div>
<div class="line">       ...</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Install hooks.</span></div>
<div class="line"><span class="comment">     * The first 5-byte code of send() and recv() are changed respectively.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    rv = funchook_install(funchook, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (rv != 0) {</div>
<div class="line">       <span class="comment">/* error */</span></div>
<div class="line">       ...</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md176"></a>
License</h2>
<p>GPLv2 or later with a <a href="https://en.wikipedia.org/wiki/GPL_linking_exception">GPL linking exception</a>.</p>
<p>You can use funchook in any software. Though funchook is licensed under the GPL, it doesn't affect outside of funchook due to the linking exception. You have no need to open your souce code under the GPL except funchook itself.</p>
<p>If you modify funchook itself and release it, the modifed part must be open under the GPL with or without the linking exception because funchook itself is under the GPL.</p>
<p><a href="https://github.com/gdabah/distorm/">diStorm3</a> has been released under 3-clause BSD since Nov 19, 2016. The license is compatible with the GPL. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="footer">
					Generated on Sat Jan 28 2023 16:49:38 for NWNX:EE by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17.
					<a href="dark/">Dark version</a>
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>
